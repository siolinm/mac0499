%!TeX root=./cinetico.tex

\FloatBarrier
\subsection{Tratamento de casos degenerados}

Como citado anteriormente, a nossa fila de prioridade $Q$ guarda os
certificados cuja chave é $t$, o instante de tempo em que o
certificado expira. Porém, é possível que dois ou mais certificados
expirem no mesmo instante de tempo $t$, configurando um empate na
nossa fila. Nos problemas anteriores, tais empates costumavam ser
tratados por algum critério de desempate que era suficiente para
garantir que as estruturas permanecessem corretas. No entanto, para
o par mais próximo cinético encontrar tal critério não é uma tarefa
tão simples.

Para olhar mais profundamente para o problema vamos antes considerar
que os eventos associados ao torneio não fazem parte da fila.

Algumas situações em que dois certificados vencem no mesmo instante
acabam não causando problemas, por exemplo, dois eventos que
envolvem pares de pontos distintos $(p, q)$ e $(r, s)$, ocorrendo no
mesmo instante de tempo $t$. Contudo, quando dois pontos se colidem,
isto é, atingem a mesma posição em $\real^2$ num instante $t'$,
ocorrem trocas nas três direções ($0^\circ$, $+60^\circ$ e
$-60^\circ$). Essas trocas precisam ser realizadas de maneira
consistente, para que as estruturas possam ser atualizadas da devida
maneira.

% Melhorar esse parágrafo
A colisão não necessariamente envolve apenas dois pontos, podem
haver mais pontos se colidindo no mesmo instante e, nesse caso,
precisamos nos preocupar também como as trocas afetam os pares de
pontos, mas como elas afetam todos o pontos envolvidos no geral.

Para determinar em que ordem os eventos devem ocorrer podemos
simular um evento não degenerado. No caso, vamos simular que os
pontos desviam em uma trajetória circular, ao longo de uma
circunferência de raio proporcional à sua velocidade, com mesma
velocidade angular, e depois seguem em frente normalmente em suas
trajetórias lineares. Adicionaremos então um parâmetro $\theta \in
[0, \pi]$ que indica o ângulo a ser percorrido até que o evento
aconteça simulando essa trajetória circular, veja a figura
\ref{degen:exemplo}.

\input{conteudo/capitulos/par/figuras/cinetico/degen/exemplo}

Como esse novo critério de desempate somos capazes de simular essa
trajetória não degenerada e os eventos ocorrerão em uma ordem
apropriada, veja um exemplo na figura \ref{degen:exemploeventos}.

\input{conteudo/capitulos/par/figuras/cinetico/degen/exemploeventos}

Existe ainda um outro detalhe de implementação que vale ser
mencionado: quando temos vários pontos se colidindo no mesmo
instante $t'$ diversos eventos serão acionados em uma determinada
ordem e, durante as alterações realizadas nos eventos, são
realizadas checagens de predecessor e sucessor em uma determinada
ordem. Porém, se os dois pontos se encontram na exata mesma posição,
não é possível determinar quem é o sucessor e quem é o predecessor
considerando apenas a posição dos pontos.

Um critério que pode ser utilizado para resolver esse problema é o
seguinte: se os dois pontos possuem a mesma coordenada é certo que
existiu, existe ou existirá um certificado na fila relacionado à
troca da ordem entre eles em uma determinada direção. Então,
comparamos esse certificado com o certificado atual da fila para
verificar se ele já foi processado ou ainda virá a ser processado.
Com isso, podemos determinar se queremos saber da situação em um
instante $t' - \epsilon$ ou $t' + \epsilon$, que pode ser computada
facilmente considerando apenas o vetor velocidade dos pontos.
